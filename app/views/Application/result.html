#{extends 'main.html' /}
#{set title:'Web Primers [Resultado]' /}
#{set pagina:'Resultado do processamento ' + processamento.id /}

#{set 'controles'}
    <a id="novo" class="btn btn-primary" href="/">Novo processamento</a>
    #{if processamento.salvo == false}
        <a id="salvar" class="btn btn-success" href="/processamento/salvar/${processamento.id}">Guardar resultado</a>
    #{/if}

    #{if processamento.salvo == true}
        <a id="recuperar" class="btn btn-default" href="/processamento">Recuperar resultado</a>
    #{/if}

#{/set}

    <div class="panel">
        <label class="label label-default">Diferenças:</label>
        <span>${processamento.quantidadeDiferencas}</span>

        <label class="label label-default">Tipo de sequência:</label>
        <span>${processamento.tipoSequencia}</span>

        <label class="label label-default">Programa:</label>
        <span>${processamento.programa.nome}</span>

        <!--<div class="info-nome">${processamento.nome}</div>-->
    </div>

    <div class="panel">
        <label class="label label-default">Inicio:</label>
        <span>${processamento.inicio?.format('dd/MM/yyyy hh:mm')}</span>

        <label class="label label-default">Fim:</label>
        <span>${processamento.fim?.format('dd/MM/yyyy hh:mm')}</span>

        <label class="label label-default">Tempo de processamento:</label>
        <span>${processamento.tempoGasto} segundo(s)</span>
    </div>

    <div class="sequencia-alfa-bloco">
        <label class="label label-primary" style="padding: 5px;">Sequência alvo:</label>
        <span class="alfa-nome">${processamento.alfaNome}</span>
        <span class="alfa-tamanho">${processamento.alfaTamanho} caracteres</span>
    </div>

    <div class="zoom">
        <a href="#" id="min" title="Clique aqui para diminuir o zoom">
            <span class="glyphicon glyphicon-minus"></span>
        </a>

        <span class="glyphicon" id="valor" data-dst="0">100%</span>

        <a href="#" id="plus" title="Clique aqui para aumentar o zoom">
            <span class="glyphicon glyphicon-plus"></span>
        </a>
    </div>

    <div class="bloco">
      <span id="j"></span>
      <div id="foo" style="width: ${processamento.alfaTamanho + 1}px">

      </div>

      <div class="fundo-sequencia" style="width: ${processamento.alfaTamanho + 1}px">
         #{list items:resultados, as:'rs'}
            <div data-j="${rs.ocorrencia.j}" class="sequencia
                 #{if processamento.mostrarMaiorMenor == true}
                    #{if rs.menor} menor #{/if}
                    #{if rs.maior} maior #{/if}
                 #{/if}"
                 #{if rs_isFirst} style="margin-left: ${rs.ocorrencia.j}px;" #{/if} ></div>
         #{/list}
      </div>

      <div id="ocorrencia" class="ocorrencia"></div>
      <span id="r"></span>
    </div>

      #{if processamento.mostrarMaiorMenor == true }
      <div class="margem-10">
          <div>
              <span class="label label-danger" style="padding: 6px">Maior segmento, com tamanho
                  <label class="badge">${processamento.maiorTamanho}</label>
              </span>
              <span>posição:
                  #{list items:maiores, as:'rs'}
                      <a class="link-ocorrencia" data-j="${rs.ocorrencia.j}">${rs.ocorrencia.j}</a>
                  #{/list}
              </span>
          </div>

          <div style="margin-top: 5px;">
              <span class="label label-success" style="padding: 6px">Menor segmento, com tamanho
                  <label class="badge">${processamento.menorTamanho}</label>
              </span>
              <span>posição:
                  #{list items:menores, as:'rs'}
                      <a class="link-ocorrencia" data-j="${rs.ocorrencia.j}">${rs.ocorrencia.j}</a>
                  #{/list}
              </span>
          </div>
      </div>
      #{/if}

      <div class="panel panel-default">
          <div class="panel-body">
            Posiçao: <label id="indice"></label>
            Tamanho: <label id="tamanho"></label>
            </br>
            Segmento: <label id="prime"></label>
          </div>
      </div>

<div class="margem-10">
    Encontrado
    <span class="badge">${ocr.quantidade}</span>
    <a href="/processamento/${processamento.id}/resultado" class="testlink" >ocorrências</a>
    <span>com ${processamento.quantidadeDiferencas} diferenças em relação à qualquer segmento da(s) sequencia(s):</span>

    <ul class="list-group" style="margin-top: 10px">
        #{list items:processamento.betas, as:'b'}
        <li class="list-group-item">
            <span class="beta-nome">${b.nome}</span>
            <span class="beta-tamanho">${b.tamanho} caracteres</span>
            <a class="testlink" href="/processamento/beta/${b.id}" style="float: right; margin-left:5px">ocorrências</a>
            <span class="badge">${b.totalOcorrencias}</span>
        </li>
        #{/list}
    </ul>
</div>

<script>
  function processa(id, j){
       $.getJSON( "/posicao/" + id + "/" + j, function( data ) {
           var r = data.tamanho;
           var t = (j + (r - 6) );

           $("#ocorrencia").css("margin-left", j + "px");
           $("#ocorrencia").css("width",r + "px");

           $("#bordas-left").css("left", j + "px");
           $("#bordas-right").css("left", t + "px");

           $("#j").html(j);
           $("#j").css("margin-left", j + "px");

           $("#r").html(r);
           t = t + 7;
           $("#r").css("margin-left", t + "px");

           $("#prime").html( data.sequencia );
           $("#indice").html(data.j);
           $("#tamanho").html(data.tamanho);
       });
  }

$( document ).ready(function() {

    $("#recuperar, .testlink, #salvar").click(function(){
       $('.div-ajax-carregamento-pagina').show();
    });

    $("#plus").click(function(){
       $(".zoom").css("margin-right", "10px")
       $("#valor").html('200%');

       $(".bloco").animate({ 'zoom': 2.0 }, 400);
    });

    $("#min").click(function(){
       $(".zoom").css("margin-right", "5px")
       $("#valor").html('100%');
       $(".bloco").animate({ 'zoom': 1.0 }, 400);
    });

    $( ".sequencia" ).click( function( event ) {
      $(".sequencia").removeClass('selected');
       var j = $(this).data("j");
      $(this).addClass('selected')
       processa(${processamento.id}, j);
    });

    processa(${processamento.id}, ${ocr.inicio});

    #{if processamento.mostrarMaiorMenor == true }
        $(".link-ocorrencia").click(function(){
            processa(${processamento.id}, $(this).data( "j" ));
        });
    #{/if}
});
</script>

  