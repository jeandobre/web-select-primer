#{extends 'main.html' /}
#{set title:'Web Primers [Processando]' /}

  <div class="container-fluid">
    <div class="page-header">
        <h1>Web <small>Sistema de seleção de regiões específicas</small></h1>
    </div>

    <div class="panel">
        <label class="label label-default">Programa:</label>
        <span>${resultado.programa}</span>
    </div>
    <div class="panel">
        <label class="label label-primary">Sequência alvo:</label>
        <span>${resultado.alfa.nome}</span>
        #{if (resultado.alfa.fasta)} <label class="label label-info">FASTA</label> #{/if}
    </div>
    <div class="panel">
        <label class="label label-primary">Quantidade de caracteres:</label>
        <span>${resultado.alfa.quantidadeCaracteres}</span>
    </div>

    <div class="bloco">
      <span id="j"></span>
        <div id="maior" class="bordas"></div>
        <div id="menor" class="bordas"></div>
        <div id="mouse" class="bordas"></div>
        <div class="fundo-sequencia" style="width: ${resultado.alfa.quantidadeCaracteres}px">
            <div class="sequencia" style="margin-left: ${resultado.ocr.inicio}px;width: ${resultado.ocr.quantidade}px"></div>
        </div>

      <div id="bordas-left" class="bordas"></div>
      <div id="bordas-right" class="bordas"></div>
      <div id="ocorrencia" class="ocorrencia"></div>
      <span id="r"></span>

    </div>


      <div class="margem-10">
          <span class="badge">${resultado.ocr.quantidade}</span> <a href="#" class="testlink">ocorrências</a>
          <span>com ${resultado.k} diferenças em relação à qualquer segmento da(s) sequencia(s):</span>

          <ul class="list-group" style="margin-top: 10px">
          #{list items:resultado.betas, as:'b'}
          <li class="list-group-item">${b.nome}
              #{if (resultado.alfa.fasta)} <label class="label label-info">FASTA</label> #{/if}
              <span class="badge">${b.quantidadeCaracteres}</span></li>
          #{/list}
          </ul>

      </div>

      #{if resultado.maiorMenor == true }
      <div class="margem-10">
          <div>
              <span class="label label-danger">Maior segmento:</span>
              <span>posição ${resultado.maior.j} com tamanho ${resultado.maior.tamanho}</span>
          </div>

          <div style="margin-top: 5px;">
              <span class="label label-success">Menor segmento:</span>
              <span>posição ${resultado.menor.j} com tamanho ${resultado.menor.tamanho}</span>
          </div>
      </div>
      #{/if}

      <div class="panel panel-default">
          <div class="panel-body">
            Posiçao: <label id="indice"></label>
            Tamanho: <label id="tamanho"></label>
            </br>
            Segmento: <label id="prime"></label>
          </div>
      </div>

      <div class="pull-right">
          <a id="novo" class="btn btn-primary" href="/">Novo processamento</a>
          <buttom id="salvar" class="btn btn-success" type="buttom">Guardar resultado</buttom>
      </div>

  </div>

<script>
  function processa(j){
       $.getJSON( "/posicao/" + j, function( data ) {
           var r = data.tamanho;
           var t = (j + (r - 6) );

           $("#ocorrencia").css("margin-left", j + "px");
           $("#ocorrencia").css("width",r + "px");

           $("#bordas-left").css("left", j + "px");
           $("#bordas-right").css("left", t + "px");

           $("#j").html(j);
           $("#j").css("margin-left", j + "px");

           $("#r").html(r);
           $("#r").css("margin-left", t + "px");

           $("#prime").html( data.sequencia );
           $("#indice").html(data.j);
           $("#tamanho").html(data.tamanho);
       });
  }

$( document ).ready(function() {
    $("#mouse").hide();
    $("#maior").hide();
    $("#menor").hide();

    $( ".sequencia" )
        .hover( function() {$("#mouse").show();}, function() {/* $("#mouse").hide(); */})

        .mousemove( function( event ) {
           var j = event.pageX - 1;
           //var position = $(".sequencia").position();
           //j = j + Math.trunc(position.left) * -1;
           $("#mouse").css("left", j);
        })
        .click( function( event ) {
           var j = event.pageX - 1;
           //$(".testlink").html(j);

           var position = $(".sequencia").position();
           j = j + Math.trunc(position.left) * -1;
           //  alert(j);
           processa(j);

        });

    processa(${resultado.j});


    #{if resultado.maiorMenor == true }
        $("#maior").css("left", ${resultado.maior.j + 16});
        $("#menor").css("left", ${resultado.menor.j + 16});
        $("#maior").show();
        $("#menor").show();
    #{/if}
});
</script>

  