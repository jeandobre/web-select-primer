#{extends 'main.html' /}
#{set title:'Web Primers [Processando]' /}

  <div class="container-fluid">
    <div class="page-header">
        <h1>Web <small>Sistema de seleção de regiões específicas</small></h1>
    </div>

    <div class="panel">
        <label class="label label-default">Programa:</label>
        <span>${programa}</span>
    </div>
    <div class="panel">
        <label class="label label-primary">Sequência alvo:</label>
        <span>${alfa.nome}</span>
        #{if (alfa.fasta)} <label class="label label-info">FASTA</label> #{/if}
    </div>
    <div class="panel">
        <label class="label label-primary">Quantidade de caracteres:</label>
        <span>${alfa.quantidadeCaracteres}</span>
    </div>

    <div class="bloco">
      <span id="j"></span>
        <div id="maior" class="bordas"></div>
        <div id="menor" class="bordas"></div>
        <div id="mouse" class="bordas"></div>
        <div class="fundo-sequencia" style="width: ${alfa.quantidadeCaracteres}px">
            <div class="sequencia" style="margin-left: ${ocr.inicio}px;width: ${ocr.quantidade}px"></div>
        </div>

      <div id="bordas-left" class="bordas"></div>
      <div id="bordas-right" class="bordas"></div>
      <div id="ocorrencia" class="ocorrencia"></div>
      <span id="r"></span>

    </div>


      <div class="margem-10">
          <span class="badge">${ocr.quantidade}</span> <a href="#" class="testlink">ocorrências</a>
          <span>com ${k} diferenças em relação à qualquer segmento da sequencia </span>
          <span class="label label-info">${beta.nome}</span>
      </div>

      #{if maior != null && menor != null }
      <div class="margem-10">
          <div>
              <span class="label label-danger">Maior segmento:</span>
              <span>posição ${maior.j} com tamanho ${maior.tamanho}</span>
          </div>

          <div style="margin-top: 5px;">
              <span class="label label-success">Menor segmento:</span>
              <span>posição ${menor.j} com tamanho ${menor.tamanho}</span>
          </div>
      </div>
      #{/if}

      <div class="panel panel-default">
          <div class="panel-body">
            Posiçao: <label id="indice"></label>
            Tamanho: <label id="tamanho"></label>
            </br>
            Segmento: <label id="prime"></label>
          </div>
      </div>

      <div class="pull-right">
          <a id="novo" class="btn btn-primary" href="/">Novo processamento</a>
          <buttom id="salvar" class="btn btn-success" type="buttom">Guardar resultado</buttom>
      </div>

  </div>

<script>
  function processa(j){
       $.getJSON( "/posicao/" + j, function( data ) {
           var r = data.tamanho;
           var t = (j + (r - 6) );

           $("#ocorrencia").css("margin-left", j + "px");
           $("#ocorrencia").css("width",r + "px");

           $("#bordas-left").css("left", j + "px");
           $("#bordas-right").css("left", t + "px");

           $("#j").html(j);
           $("#j").css("margin-left", j + "px");

           $("#r").html(r);
           $("#r").css("margin-left", t + "px");

           $("#prime").html( data.sequencia );
           $("#indice").html(data.j);
           $("#tamanho").html(data.tamanho);
       });
  }

$( document ).ready(function() {
    $("#mouse").hide();

    $( ".sequencia" )
        .hover( function() {$("#mouse").show();}, function() {/* $("#mouse").hide(); */})

        .mousemove( function( event ) {
           var j = event.pageX - 1;
           //var position = $(".sequencia").position();
           //j = j + Math.trunc(position.left) * -1;
           $("#mouse").css("left", j);
        })
        .click( function( event ) {
           var j = event.pageX - 1;
           //$(".testlink").html(j);

           var position = $(".sequencia").position();
           j = j + Math.trunc(position.left) * -1;
           //  alert(j);
           processa(j);

        });

    processa(${j});
    $("#maior").hide();
    $("#menor").hide();

    #{if maior != null && menor != null }
        $("#maior").css("left", ${maior.j + 16});
        $("#menor").css("left", ${menor.j + 16});
    #{/if}
});
</script>

  