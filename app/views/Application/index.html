#{extends 'main.html' /}
#{set title:'Web Primers [início]' /}
#{set pagina:'Novo processamento' /}

<link href="@{'/public/stylesheets/jquery.filer.css'}" rel="stylesheet">
<script src="@{'/public/javascripts/jquery.filer.min.js'}" type="text/javascript" charset="${_response_encoding}"></script>

  #{form @Application.process(), enctype:'multipart/form-data', id:'formulario' }

    #{set 'controles'}
      <input id="processar-top" class="btn btn-primary processar" type="submit" value="Processar">
      <a id="recuperar-top" class="btn btn-default" href="/processamento">Recuperar resultado</a>
    #{/set}

    <div class="panel">
      <div class="panel-body">
        <div class="form-group">
          <label for="alfa" class="col-sm-2 control-label">Sequência alvo:</label>
          <div class="col-sm-10">
            <input id="alfa" type="file" class="form-control file" name="parametro.alfa">
            <span class="help-block">Selecione um arquivo de texto de sequência de DNA.</span>
          </div>
        </div>
        <div class="form-group">
          <label for="beta" class="col-sm-2 control-label">Sequência(s):</label>
          <div class="col-sm-10">
            <input id="beta" type="file" class="form-control file"
                   name="parametro.beta" multiple="multiple" >
            <span class="help-block">Selecione um arquivo de texto de sequência de DNA.</span>
          </div>
        </div>

        <div class="form-group">
          <label for="k" class="col-sm-2 control-label">Diferenças:</label>
          <div class="col-sm-1">
            <input id="k" type="text" class="form-control" placeholder="1" name="parametro.k">
            
          </div> 
          <span class="help-block">Digite a quantidade de diferenças desejada para a o segmento da sequência alvo
            com qualquer segmento de outras sequências.<br/>
          O valor deve estar entre 1 e o tamanho da sequência alvo.</span>
        </div>
      </div>
    </div>

    <div class="panel panel-default panel-info" style="margin: 10px;">
      <div class="panel-heading">Opções</div>
      <div class="panel-body">

        <div class="row">
          <div class="col-md-6">
            <div class="bs-callout bs-callout-warning">
              <h4>Tipos de sequência</h4>
            </div>
            <label class="radio-inline">
              <input type="radio" name="parametro.tipoSequencia" id="sequencia-diferente"
                     data-toggle="tooltip" title="Sequências são bem diferentes"
                     value="DIFERENTES" checked> Sequências diferentes
            </label>
            <label class="radio-inline">
              <input type="radio" name="parametro.tipoSequencia" id="sequencia-semelhante"
                     data-toggle="tooltip" title="Sequência são muito parecidas"
                     value="PARECIDAS"> Sequências semelhantes
            </label>
            <label class="radio-inline">
              <input type="radio" name="parametro.tipoSequencia" id="heuristica"
                     data-toggle="tooltip" title="Heurística"
                     value="HEURISTICA"> Heurística
            </label>
          </div>

          <div class="col-md-6">
            <div class="bs-callout bs-callout-warning">
              <h4>Posições</h4>
            </div>
            <div class="radio">
              <input type="radio" name="parametro.tipoProcessamento" id="todas-posicao" value="1" >
              Processar todas as posições possiveis.
            </div>
            <div class="radio">
              <input type="radio" name="parametro.tipoProcessamento" id="uma-posicao" value="2" checked
                     title="Selecione a posição de inicio e tamanho (quantidade de posições) que deverão ser processadas">
              Selecionar uma posição e um tamanho.
            </div>

            <div class="form-group" id="opcoes">
              <div>
                <label for="j" class="col-sm-2 control-label">Posição:</label>
                <div class="col-sm-2">
                    <input id="posicao" type="text" class="form-control" name="parametro.j"
                           title="A posição de inicio de processamento da sequência alvo.">
                </div>

                <label for="distancia" class="col-sm-2 control-label">Tamanho:</label>
                <div class="col-sm-2">
                    <input id="distancia" type="text" class="form-control"
                           name="parametro.distancia"
                           title="O tamanho ou quantidade de índices que serão processados apartir da posição.">
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="row">
          <div class="checkbox" style="margin-left: 25px;">
            <label>
              <input type="checkbox" name="parametro.regioesTamanhoFixo"> Devolver regiões de tamanho entre certos valores (1.000 a 2.000)
            </label>
          </div>

          <div class="checkbox" style="margin-left: 25px;">
            <label>
              <input type="checkbox" name="parametro.maiorMenor"> Devolver maior/menor região
            </label>
          </div>

        </div>
      </div>
    </div>

  #{/form}

<script>
        $( document ).ready(function() {

          $('[data-toggle="tooltip"]').tooltip();

          $('#alfa').filer({
              showThumbs: true,
              addMore: false,
              allowDuplicates: false,
              limit: 1,
              maxSize: null,
              appendTo: null,
              progressBar: '<div class = "bar"></div>',
              itemAppendToEnd: false,
              removeConfirmation: false
          });

          $('#beta').filer({
              showThumbs: true,
              addMore: true,
              allowDuplicates: false,
              limit: 10,
              maxSize: null,
              showThumbs: true,
              appendTo: null,
              progressBar: '<div class = "bar"></div>',
              itemAppendToEnd: false,
              removeConfirmation: false
          });

          $("#k, #posicao, #distancia").keypress(function (e) {
            if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
               return false;
             }
          });


          $("#todas-posicao").change(function(){
            if(this.checked) {
              $("#opcoes").hide();
            }
          });

          $("#uma-posicao").change(function(){
            if(this.checked) {
              $("#opcoes").show();
            }
          });

          $("#processar-top").click(function(){
            $('.div-ajax-carregamento-pagina').show();
            $( "#formulario" ).submit();

            $('.div-ajax-carregamento-pagina').append('<button id="cancelar" type="button" class="btn btn-danger">Cancelar processamento</button>');

            $('#cancelar').click(function(){
                $(location).attr('href', '/')
            });
          });

          $("#recuperar-top").click(function(){
            $('.div-ajax-carregamento-pagina').show();
          });

        });
</script>