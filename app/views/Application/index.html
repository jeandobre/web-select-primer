#{extends 'main.html' /}
#{set title:'Web Primers [início]' /}
#{set pagina:'Novo processamento' /}

<link href="@{'/public/stylesheets/jquery.filer.css'}" rel="stylesheet">
<script src="@{'/public/javascripts/jquery.filer.min.js'}" type="text/javascript" charset="${_response_encoding}"></script>

  #{form @Application.process(), enctype:'multipart/form-data', id:'formulario' }

    #{set 'controles'}
      <input id="processar-top" class="btn btn-primary processar" type="submit" value="Processar">
      <a id="recuperar-top" class="btn btn-default" href="/processamento">Recuperar resultado</a>
    #{/set}

    <div class="panel">
      <div class="panel-body">
        <div class="row">
          <label class="control-label col-sm-2">Sequência alvo</label>
        </div>
        <div class="row">
          <div class="col-sm-6">
              <div class="input-group">
                <span class="input-group-addon">
                  <input id="tipo-sequencia-alfa-file" type="radio" name="parametro.tipoSequenciaAlfa" value="2" checked >Arquivo
                </span>
                <input id="alfa" type="file" class="form-control" name="parametro.alfa" >
              </div>
          </div>
          <div class="col-sm-6">
              <div class="input-group">
                <span class="input-group-addon">
                   <input id="tipo-sequencia-alfa-texto" type="radio" name="parametro.tipoSequenciaAlfa" value="1" >Texto
                </span>
                <textarea id="alfa-texto" name="parametro.textoAlfa" placeholder="Digite a sequência..."
                      rows="4" maxlength="1000" style="resize: none"
                      class="form-control"></textarea>
              </div>
          </div>
        </div>

        <div class="row">
             <label class="control-label col-sm-2">Sequência(s) para comparação</label>
        </div>

        <div class="row">
          <div class="col-sm-6">
              <div class="input-group">
                <span class="input-group-addon">
                   <input id="tipo-sequencia-beta-file" type="radio" name="parametro.tipoSequenciaBeta" value="2" checked >Arquivo
                </span>
                <input id="beta" type="file" class="form-control" name="parametro.beta" multiple="multiple" >
              </div>
          </div>
          <div class="col-sm-6">
              <div class="input-group">
                <span class="input-group-addon">
                   <input id="tipo-sequencia-beta-texto" type="radio" name="parametro.tipoSequenciaBeta" value="1"  >Texto
                </span>
                <textarea id="beta-texto" name="parametro.textoBeta" placeholder="Digite a sequência..."
                       rows="4" maxlength="1000" style="resize: none"
                       class="form-control"></textarea>
              </div>
          </div>
        </div>

        <div class="row" style="margin-top: 5px">
          <label for="k" class="col-sm-2 control-label">Diferenças:</label>
          <div class="col-sm-1">
            <input id="k" type="text" class="form-control" placeholder="1" name="parametro.k">
          </div> 
          <span class="help-block">Digite a quantidade de diferenças desejada.<br/>
          O valor deve estar entre 1 e o tamanho da sequência alvo.</span>
        </div>
      </div>
    </div>

    <div class="panel panel-default panel-info" style="margin: 10px;">
      <div class="panel-heading">Opções de processamento</div>
      <div class="panel-body">

        <div class="row">
          <div class="col-md-6">
              <div class="bs-callout bs-callout-warning">
                <h4>Tipos de sequência</h4>
              </div>
              <label class="radio-inline" style="margin-left: 25px">
                <input type="radio" name="parametro.tipoSequencia" id="sequencia-diferente"
                       data-toggle="tooltip" title="Sequências são bem diferentes"
                       value="DIFERENTES" checked> Sequências diferentes
              </label>
              <label class="radio-inline">
                <input type="radio" name="parametro.tipoSequencia" id="sequencia-semelhante"
                       data-toggle="tooltip" title="Sequência são muito parecidas"
                       value="PARECIDAS"> Sequências semelhantes
              </label>
              <label class="radio-inline">
                <input type="radio" name="parametro.tipoSequencia" id="heuristica"
                       data-toggle="tooltip" title="Heurística"
                       value="HEURISTICA"> Heurística
              </label>

              <div class="bs-callout bs-callout-warning">
                <h4>Tipo de processamento</h4>
              </div>
              <label class="radio" style="margin-left: 45px; font-weight: 400;">
                <input type="radio" name="parametro.tipoProcessamento" id="todas-posicao" value="1"
                       title="Processar todas as posições possíveis da sequência alvo">
                Todas as posições da sequência alvo.
              </label>
              <label class="radio" style="margin-left: 45px; font-weight: 400;">
                <input type="radio" name="parametro.tipoProcessamento" id="uma-posicao" value="2" checked
                       title="Selecione um intervalo de posições que deverão ser processadas">
                Intervalo de posições da sequência alvo.
              </label>

              <div class="form-group" id="opcoes" style="margin-left: 70px; font-weight: 400;">
                  <label for="jInicio" class="control-label">Entre</label>

                    <input id="jInicio" type="text" class="form-control" name="parametro.jInicio"
                           style="width: 50px; display: inline"
                           title="A posição de inicio de processamento da sequência alvo.">

                  <label for="jFim" class="control-label">e</label>

                    <input id="jFim" type="text" class="form-control"
                           name="parametro.jFim" style="width: 60px; display: inline"
                           title="A posição de fim de processamento da sequência alvo.">
              </div>

              <div class="checkbox" style="margin-left: 25px;">
                <input type="checkbox" name="parametro.maiorMenor" id="maior-menor" value="True">
                <label for="maior-menor" class="control-label" >Mostrar maior/menor ocorrência</label>
              </div>
            </div>

          <div class="col-md-6">
            <div class="bs-callout bs-callout-warning">
              <h4>
                <span class="glyphicon glyphicon-filter"></span>
                Filtros
              </h4>
            </div>

            <div class="checkbox" style="margin-left: 25px;">
              <input type="checkbox" name="parametro.mostrarDistancia" id="mostrar-distancia" />
              <label for="mostrar-distancia" >Mostrar apenas ocorrências distantes
                <input id="distancia" type="text" class="form-control" name="parametro.distancia"
                       style="width: 50px; display: inline" /> uma da outra.
              </label>
            </div>

            <div class="checkbox" style="margin-left: 25px;">
              <input type="checkbox" name="parametro.mostrarLimiteCaracteres" id="limite-caracteres" />
              <label for="limite-caracteres">Mostrar apenas ocorrências com tamanho até
                <input type="text" class="form-control" name="parametro.limiteCaracteres"
                       id="limite"
                       style="width: 50px; display: inline" /> caracteres.</span>
              </label>
            </div>
          </div>
      </div>
    </div>

      <input type="file" id="files" visbility="hidden" hidden />
  #{/form}

<script>
        $( document ).ready(function() {

          $('#alfa-texto').keypress(function(){
             $('#tipo-sequencia-alfa-texto').attr('checked', true);
          });
          $('#beta-texto').keypress(function(){
             $('#tipo-sequencia-beta-texto').attr('checked', true);
          });


          $('[data-toggle="tooltip"]').tooltip();

          $('#alfa').filer({
              showThumbs: true,
              addMore: false,
              allowDuplicates: false,
              limit: 1,
              maxSize: null,
              appendTo: null,
              progressBar: '<div class = "bar"></div>',
              itemAppendToEnd: false,
              removeConfirmation: false
          });

          $('#beta').filer({
              showThumbs: true,
              addMore: true,
              allowDuplicates: false,
              limit: 10,
              maxSize: null,
              showThumbs: true,
              appendTo: null,
              progressBar: '<div class = "bar"></div>',
              itemAppendToEnd: false,
              removeConfirmation: false
          });

          $("#k, #jInicio, #jFim, #distancia, #limite").on('keypress', function (e) {
            if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
               return false;
            }
          });

          $('#distancia, #limite').on('keyup', function(){
            $('#mostrar-distancia').prop('checked', $('#distancia').val().length > 0);
            $('#limite-caracteres').prop('checked', $('#limite').val().length > 0);
          });


          $("#todas-posicao").change(function(){
            if(this.checked) {
              $("#opcoes").hide();
            }
          });

          $("#uma-posicao").change(function(){
            if(this.checked) {
              $("#opcoes").show();
            }
          });

          $("#processar-top").click(function(){
            $('.div-ajax-carregamento-pagina').show();
            $( "#formulario" ).submit();

            $('.div-ajax-carregamento-pagina').append('<button id="cancelar" type="button" class="btn btn-danger">Cancelar processamento</button>');

            $('#cancelar').click(function(){
                $(location).attr('href', '/')
            });
          });

          $("#recuperar-top").click(function(){
            $('.div-ajax-carregamento-pagina').show();
          });

        });
</script>